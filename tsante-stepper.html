<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="tsante-stepper">

  <template>
    <style>
      :host, ::slotted(*) {
        display: flex;
      }
    </style>
    
    <div id="stepper">
      <slot></slot>
    </div>
    
  </template>

  <script>
    class TsanteStepper extends Polymer.Element {
      static get is() {
        return 'tsante-stepper';
      }
      static get properties() {
        return {
          selectedIndex: {
            type: Number,
            value: -1,
            observer: 'selectedChanged'
          },
          clickable: {
            type: Boolean,
            value: false,
            reflectToAttribute: true
          }
        }
      }
      ready() {
        super.ready()
        this.addEventListener('tsante-step-click', this.onStepClicked.bind(this))
      }
      getSteps() {
        const nodes = this.shadowRoot.querySelector('slot').assignedNodes()
        return nodes.filter(node => node.tagName === 'TSANTE-STEP')
        
      }
      unselectAll() {
        this.getSteps().forEach(step => step.selected = false)
      }
      select(index) {
          const step = this.getSteps()[index]
          if(step){
            step.selected = true
          }
      }
      
      onStepClicked(evt) {
        if(this.clickable){
          const step = evt.detail
          const index = this.getSteps().indexOf(step)
          this.selectedIndex = index
        }
      }
      selectedChanged(next, previous) {
        const max = this.getSteps().length-1
        if(next >= 0 && next <= max){
          this.unselectAll()
          this.select(next)
        } else {
          this.selectedIndex = (next > max) ? max : 0
        }
      }
      next() {
        this.selectedIndex++
      }
      previous() {
        this.selectedIndex--
      }
    }
    customElements.define(TsanteStepper.is, TsanteStepper);
  </script>

</dom-module>
